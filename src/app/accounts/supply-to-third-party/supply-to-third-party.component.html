<div class="container-fluid">
    <mat-card class="matcard">
        <mat-card-content>
            <div class="row">
                <div class="col-sm-12">
                    <h2 class="head">Job Work Outward</h2>
                </div>
            </div>
            <form #tableTop [formGroup]="supplyForm"
                (ngSubmit)="save()">
                <div class="row ml-3">
                    <div class="col-sm-4" style="display: flex">
                        <div class="labeldiv">
                            <label class="pt-2" style="margin: auto">ThirdParty
                                Name<span
                                    class="text-danger">*</span></label>
                        </div>
                        <div class="inputdiv">
                            <mat-form-field>
                                <mat-label>Third Party Name</mat-label>
                                <mat-select
                                    [ngClass]="{'is-invalid':supplyForm.controls.third_partyid.touched && supplyForm.controls.third_partyid.errors}"
                                    formControlName="third_partyid" #advw
                                    required>
                                    <mat-form-field>
                                        <input matInput type="text" #auval
                                            (input)="suggest(auval.value)"
                                            placeholder="Search...">
                                    </mat-form-field>

                                    <mat-option [value]="option.third_partyid"
                                        *ngFor="let option of suggestions">
                                        {{option.party_name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="col-sm-4" style="display: flex">
                        <div class="labeldiv">
                            <label class="pt-2" style="margin: auto">Date<span
                                    class="text-danger">*</span></label>
                        </div>
                        <div class="inputdiv">
                            <input
                                [ngClass]="{'is-invalid': supplyForm.controls.date.touched && supplyForm.controls.date.errors}"
                                class="form-control" formControlName="date"
                                type="date" required />
                        </div>
                    </div>

                    <div class="col-sm-4" style="display: flex">
                        <div class="labeldiv">
                            <label class="pt-2" style="margin: auto">Bill No<span
                                    class="text-danger">*</span></label>
                        </div>
                        <div class="inputdiv">
                            <input
                                [ngClass]="{'is-invalid':supplyForm.controls.bill_no.touched && supplyForm.controls.bill_no.errors}"
                                class="form-control" formControlName="bill_no"
                                type="text" required readonly />
                        </div>
                    </div>
                </div>

                <div class="row ml-3">
                    <div class="col-sm-4" style="display: flex">
                        <div class="labeldiv">
                            <label class="pt-2" style="margin: auto">
                                Product Name<span
                                    class="text-danger">*</span></label>
                        </div>
                        <div class="inputdiv">
                            <select class="form-control"
                                (change)="getNested()"
                                [ngClass]="{'is-invalid': supplyForm.controls.productid.touched && supplyForm.controls.productid.errors}"
                                formControlName="productid" required>
                                <option selected disabled value="null">Please
                                    Select</option>
                                <option
                                    *ngFor="let option of linkProductList"
                                    [ngValue]="option.productid">
                                    {{option.product_name}}</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-4" style="display: flex">
                        <div class="labeldiv">
                            <label class="pt-2" style="margin: auto">Qty<span
                                    class="text-danger">*</span></label>
                        </div>
                        <div class="inputdiv">
                            <input (input)="getNested()"
                                [ngClass]="{'is-invalid': supplyForm.controls.qty.touched && supplyForm.controls.qty.errors}"
                                class="form-control" formControlName="qty"
                                type="text" required />
                        </div>
                    </div>
                </div>

                <div class="table-responsive mt-4">
                    <table
                        class="col-sm-12 table table-hover table-sm table-bordered">
                        <thead class="tablehead">
                            <tr>
                                <th>#</th>
                                <th>Product Name</th>
                                <th>Unit</th>
                                <th>Actual Qty</th>
                                <!-- <th>Qty</th> -->
                            </tr>
                        </thead>
                        <tbody formArrayName="supply_nested">
                            <tr
                                *ngFor="let chid of getCommonControls(); let i = index"
                                formGroupName="{{i}}">
                                <td>{{i+1}}</td>
                                <td style="min-width: 150px;"><select
                                        [ngClass]="{'is-invalid': isProductControlInvalid(i)}"
                                        formControlName="n_productid"
                                        class="form-control" required>
                                        <option disabled [ngValue]="null"
                                            selected>Please select</option>
                                        <option disabled
                                            [ngValue]="item.n_productid"
                                            *ngFor="let item of NestedProductList">
                                            {{item.n_product_name}}</option>
                                    </select>
                                </td>
                                <td>{{chid.get('unit_name')?.value}}</td>
                                <td style="min-width: 120px;"><input
                                        [ngClass]="{'is-invalid': isAtytrolInvalid(i)}"
                                        formControlName="a_qty" readonly
                                        class="form-control" required></td>

                                <!-- <td style="min-width: 100px;"><input
                                        [ngClass]="{'is-invalid': isQtyControlInvalid(i)}"
                                        formControlName="qty" readonly
                                        class="form-control" required></td> -->
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="row">
                    <div class="col-sm-12" style="display: flex;">
                        <div style="margin: auto;">
                            <button type="submit" style="width: 80px;"
                                class="btn btn-success mr-3 btn-sm">
                                <span> {{supplyForm.value.supplyid ==0
                                    ? 'Save' :
                                    'Edit'}}</span></button>
                            <input type="button" style="width: 80px;"
                                (click)="cancelClick()"
                                class="btn btn-primary mr-3 btn-sm"
                                value="Clear" />
                            <input type="button" style="width: 80px;"
                                class="btn btn-danger btn-sm"
                                (click)="backButton()" value="Close" />
                        </div>
                    </div>
                </div>
            </form>
        </mat-card-content>
    </mat-card>

    <mat-card class="mt-3 matcardlist">
        <mat-card-content>
            <div class="row">
                <div class="col-sm-12" style="display: flex;">
                    <div>
                        <input #ds (change)=" getRawMAtrialList(ds.value)"
                            style="max-width: 180px;" type="date"
                            class="form-control" />
                    </div>
                    <div>
                        <button class="btn btn-info ml-2"
                            (click)="getRawMAtrialList('All')">GET All DATE</button>
                    </div>
                </div>
                <div class="table-responsive mt-2">
                    <table class="table table-hover table-sm col-sm-12">
                        <thead class="tableheadList">
                            <tr>
                                <th style="text-align: left;">Third Party Name</th>
                                <th>Date</th>
                                <th>Bill No</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of rawProductList;let i=index">
                                <td style="text-align: left;">{{item.party_name}}</td>
                                <td>{{item.date}}</td>
                                <td>{{item.bill_no}}</td>
                                <td>
                                    <mat-icon class="mr-1"
                                        style="cursor: pointer;color: blue;"
                                        title="Click to edit"
                                        (click)="update(item)">edit</mat-icon>

                                    <mat-icon class="ml-1"
                                        style="cursor: pointer;color: red;"
                                        title="Click to delete"
                                        (click)="deleteFun(item.supplyid)">delete</mat-icon>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </mat-card-content>
    </mat-card>
</div>